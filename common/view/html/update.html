<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <link rel="icon" href="http://127.0.0.1:8023/static/image/img.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>CLL</title>
    <link rel="stylesheet" href="/static/js/layui-v2.6.8/css/layui.css">
    <link rel="stylesheet" href="/static/css/config.css">
    <style>
        .child {
            display: inline-block;
            /*子元素文字会继承居中，因此要在上面写上向左边居中*/
            text-align: left;
            background-color: #FAFAFA;
            width: 1000px;
            height: 200px;/*无更新：160px、有更新：200px起*/
            border-radius: 5px;
        }

        .parent {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 30px;
        }

        .layui-border {
            border-color: #FFB6C1 !important;
            color: #FFB6C1 !important;
        }

        .layui-laydate .layui-this {
            background-color: #1E9FFF !important;
            color: #fff !important;
        }

        .tips-night {
            color: #EAECEE;
            -webkit-background-clip: text;
            font-weight: bold;
        }

        .tips-day {
            color: #1B2631;
            -webkit-background-clip: text;
            font-weight: bold;
        }

        .layui-form-item .layui-input-inline {
            float: left;
            margin-top: 12px;
            width: 190px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
<form class="layui-form" action="">
    <div class="parent">
        <div class="child">
            <div class="layui-form-item" style="margin-top: 20px;margin-left: 20px;">
                <div style="margin-left: 50px;margin-top: 40px;font-size: 17px;font-weight: bold;">
                    <span>当前版本：</span>
                    <span id="version"></span>
                    <span style="margin-left: 50px;"><button type="button" id="mail-box-button" class="layui-btn  layui-btn-primary layui-btn-sm">检查更新</button></span>
                </div>
                <div id="no_new_version" style="margin-left: 50px;margin-top: 20px;display: block;">
                    <span>已是最新版本，无需更新</span>
                </div>
                <div id="new_version" style="margin-left: 50px;margin-top: 20px;display: block;">
                    <span>最新版本：</span>
                    <span>v 3.3</span>
                    <div style="margin-top: 10px;line-height: 25px;width: 870px;">修复了部分问题</div>
                </div>
            </div>
        </div>
    </div>
</form>
<script src="/static/js/layui-v2.6.8/layui.js"></script>
<script type="text/javascript" src="/static/js/jquery-2.1.3.js"></script>
<script src="/static/js/config.js" charset="utf-8"></script>
<script>
    layui.use(['layer', 'laydate'], function () {
        let form = layui.form;
        let layer = layui.layer;
        let date = new Date();
        let read = false
        if (date.getHours() >= 18 || date.getHours() <= 6) {
            $("body").css("background-color", "#111")
            $(".child").css("background-color", "#222").css("color", "#f2f2f2")
            $("input").css("background-color", "#333")
            $("input").css("border", "none")
            $("input").css("color", "#f2f2f2")
            $("#tips").removeClass("tips-day")
            $("#tips").addClass("tips-night")
            form.render();
        } else {
            $("#tips").removeClass("tips-night")
            $("#tips").addClass("tips-day")
        }

        window.checkUpdate = function () {
            $.ajax({
                url: "/system/check_update", // 替换为实际的API端点
                method: "POST", // 请求方法，可以是 "GET" 或 "POST" 等
                dataType: "json", // 预期的响应数据类型
                success: function (data) {
                    // 请求成功时的处理
                    if (data.ret > 0) {
                        layer.msg(data.msg, {icon: 5, anim: 6});
                        return false
                    }
                    let currentVersion = data.data.current_version
                    let newVersion = data.data.new_version
                    if (newVersion > currentVersion) {
                        $("#new_version").show()
                        localStorage.setItem("mail-download-has-new-version", "true");
                    } else {
                        $("#no_new_version").show()
                    }
                    localStorage.setItem("mail-download-new-version", newVersion);
                    localStorage.setItem("mail-download-current-version", currentVersion);
                    $("#version").text("V "+currentVersion)
                },
                error: function (error) {
                    // 请求失败时的处理
                    layer.msg("服务器异常", {icon: 5, anim: 6});
                }
            });
        }

        let hasNew = localStorage.getItem("mail-download-has-new-version")
        if (hasNew != "true") {
            checkUpdate()
        } else {
            $("#new_version").show()
            $("#version").text("v "+localStorage.getItem("mail-download-current-version"))
        }
    });
</script>
</body>
</html>